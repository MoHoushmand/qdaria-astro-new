---
import { getRelativeLocaleUrl } from "astro:i18n";
import { type CollectionEntry } from "astro:content";

// components
import Category from "@components/Category/Category.astro";

// utils
import { formatDate } from "@js/textUtils";
import { getLocaleFromUrl } from "@js/localeUtils";

interface Props {
  post: CollectionEntry<"blog">;
  showDescription?: boolean;
  class?: string;
  rest?: any;
}

const {
  post,
  showDescription = false,
  class: className,
  ...rest
} = Astro.props as Props;
const { title, description, categories, pubDate, heroImage } = post.data;

const currLocale = getLocaleFromUrl(Astro.url);
---

<article class:list={["blog-card-large group", className]} {...rest}>
  <div class="grid gap-6 md:grid-cols-5">
    <a
      href={getRelativeLocaleUrl(currLocale, `/blog/${post.slug}/`)}
      class="block aspect-video overflow-hidden rounded-xl md:col-span-3"
    >
      <img
        src={heroImage}
        alt={`Cover for ${title}`}
        width="800"
        height="450"
        class="h-full w-full object-cover transition-transform duration-500 group-hover:scale-105"
        loading="eager"
      />
    </a>
    <div class="flex flex-col justify-center md:col-span-2">
      <!-- categories -->
      <div class="flex flex-wrap gap-2">
        {categories.map((category) => <Category category={category} />)}
      </div>

      <!-- title -->
      <h2 class="blog-card-title-large mt-4">
        <a href={getRelativeLocaleUrl(currLocale, `/blog/${post.slug}/`)}>
          {title}
        </a>
      </h2>

      <!-- description -->
      {
        showDescription && (
          <p class="mt-3 line-clamp-3 text-base text-base-400 md:text-lg">
            {description}
          </p>
        )
      }

      <!-- published date -->
      <p class="mt-6 text-xs font-medium uppercase tracking-wider text-base-500">
        {formatDate(pubDate, currLocale)}
      </p>
    </div>
  </div>
</article>

<style>
  /* EXACT copy of Amplify hover-border-glow effect */
  .blog-card-large {
    @apply rounded-xl border border-base-800 bg-base-950 p-4 md:p-6;
    position: relative;
    transition: all 300ms;
  }

  .blog-card-large::before {
    content: '';
    position: absolute;
    inset: 0.125rem;
    z-index: -10;
    border-radius: 0.75rem;
    background-color: #3b82f6;
    opacity: 0;
    filter: blur(8px);
    transition: all 300ms;
  }

  .blog-card-large:hover {
    border-color: #7dd3fc;
  }

  .blog-card-large:hover::before {
    opacity: 1;
  }

  .blog-card-title-large {
    @apply text-xl font-medium leading-snug md:text-2xl;
    @apply text-base-100 transition-colors duration-300;
  }

  .blog-card-large:hover .blog-card-title-large {
    @apply text-primary-400;
  }
</style>
